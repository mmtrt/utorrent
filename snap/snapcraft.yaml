name: utorrent
version: 3.5.4.44520
summary: utorrent is the no-1 BitTorrent download client on desktops worldwide.
description: |
 utorrent is a proprietary BitTorrent client owned and developed by BitTorrent, Inc. With over 100 million users it is the most widely used BitTorrent client. The program was designed to use minimal computer resources while offering functionality comparable to larger BitTorrent clients such as Vuze or BitComet.

confinement: strict
grade: stable
architectures:
  - build-on: amd64
    run-on: [amd64, i386]

apps:
  utorrent:
    command: utorrent
    desktop: usr/share/applications/utorrent.desktop
    plugs: [ wayland, x11, opengl, home, desktop, desktop-legacy, network, network-observe, mount-observe, hardware-observe, process-control, cups-control, browser-support ]

parts:
  enable-i386:
    plugin: nil
    override-build: |
      snapcraftctl build
      dpkg --add-architecture i386
      apt update

  wine-3p1:
    after: [enable-i386]
    plugin: dump
    source: https://dl.winehq.org/wine-builds/ubuntu/pool/main/wine-stable-i386_3.0.2~xenial_i386.deb
    source-type: deb
    override-build: |
      snapcraftctl build
      spi=$SNAPCRAFT_PART_INSTALL
      lins=$spi/usr/share/lintian
      docs=$spi/usr/share/doc
      mans=$spi/usr/share/man
      ws=opt/wine-stable
      cp -r $ws/* $spi/ && cp -r $spi/share $spi/usr/ && rm -r $spi/opt $spi/share $mans $lins $docs
    stage-packages:
      - libfreetype6:i386
      - libpng12-0:i386
      - libncurses5:i386
      - libgnutls30:i386
      - libxext6:i386
      - libudev1:i386
      - libc6:i386
      - libxrender1:i386
      - zlib1g:i386

  wine-3p2:
    plugin: dump
    source: https://dl.winehq.org/wine-builds/ubuntu/pool/main/wine-stable_3.0.2~xenial_i386.deb
    source-type: deb
    override-build: |
      snapcraftctl build
      spi=$SNAPCRAFT_PART_INSTALL
      docs=$spi/usr/share/doc
      mans=$spi/share/man
      ws="opt/wine-stable"
      cp -r $ws/* $spi/ && rm -r $spi/opt $docs $mans $spi/share/wine/fonts

  utorrent:
    plugin: nil
    source: ./scripts
    override-build: |
      snapcraftctl build
      set -ex
      ./dl_ut
    stage:
      - bin
      - usr
      - share
    build-packages: [wget, icoutils, p7zip-full]
